<!DOCTYPE html>
<html>
<head>
  <title>Robin8</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <% if !Rails.env.development? && china_request? %>
    <!--<link href="//fonts.useso.com/css?family=Open+Sans:400,300,600,800,700,400italic,600italic,700italic,800italic,300italic" rel="stylesheet" type="text/css">-->
    <!--<script src="http://maps.google.cn/maps/api/js?libraries=places&sensor=false"></script>-->
  <% elsif !Rails.env.development? %>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,800,700,400italic,600italic,700italic,800italic,300italic" rel="stylesheet" type="text/css">
    <script src="//maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
  <% end %>

  <% if Rails.env.development? &&  Rails.application.config.china_instance %>
    <%= stylesheet_link_tag    '/assets/kol/dev_base_compact', 'kol/dev_reload', media: 'all', 'data-turbolinks-track' => true %>
    <%= javascript_include_tag '/assets/kol/dev_base_compact', 'kol/dev_reload', 'data-turbolinks-track' => true %>
  <% else %>
    <%= stylesheet_link_tag    'kol/application', media: 'all', 'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'kol/application', 'data-turbolinks-track' => true %>
  <% end %>
  <%= csrf_meta_tags %>
  <%= favicon_link_tag 'favicon.ico' %>
</head>
<body>
  <% if flash[:confirmation_alert] %>
    <div class="activation-alert alert-warning" role="alert"><p class="confirmation"><%= flash[:confirmation_alert] %></p></div>
  <% end %>

  <div id="main">
    <%= yield %>
  </div>

  <div class="modal fade" id="modal" tabindex="-1"
    role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>

<script type="text/javascript">
    $(document).ready(function() {
      Robin.chinaInstance = <%= china_instance?  %>;
      Robin.chinaLocale = <%= china_locale? %>;
      Robin.chinaRequest = <%= china_request? %>;
      Robin.mobileRequest = <%= mobile_request? %>;
      Robin.start();
    });
  polyglot = new Polyglot({phrases: <%= raw @phrases.to_json %>});
  <% if flash[:success_confirmation] -%>
    Robin.afterConfirmationMessage = '<%= flash[:success_confirmation] %>'
  <% end -%>
  <% if kol_signed_in? -%>
    Robin.currentKOL = new Robin.Models.KOL(<%= current_kol.to_json(:methods => [:screens, :identities, :stats]).html_safe %>);
  <% else -%>
    if (Robin) {
      Robin.currentKOL = null;
    }
  <% end -%>

  <% if Rails.env == 'development' -%>
    Robin.showLoading = false;
  <% else -%>
    Robin.showLoading = true;
  <% end -%>
</script>

</body>
<%=render :partial => "shared/feedback"%>
</html>
