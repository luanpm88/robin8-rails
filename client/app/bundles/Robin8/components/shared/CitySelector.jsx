//工作地点
var ja=[];

ja['0100']='北京';
ja['0200']='上海';
ja['0300']='广东省';
ja['0302']='广州';
ja['0303']='惠州';
ja['0304']='汕头';
ja['0305']='珠海';
ja['0306']='佛山';
ja['0307']='中山';
ja['0308']='东莞';
ja['0314']='韶关';
ja['0315']='江门';
ja['0317']='湛江';
ja['0318']='肇庆';
ja['0319']='清远';
ja['0320']='潮州';
ja['0321']='河源';
ja['0322']='揭阳';
ja['0323']='茂名';
ja['0324']='汕尾';
ja['0325']='顺德';
ja['0326']='梅州';
ja['0327']='开平';
ja['0328']='阳江';
ja['0329']='云浮';
ja['0400']='深圳';
ja['0500']='天津';
ja['0600']='重庆';
ja['0700']='江苏省';
ja['0702']='南京';
ja['0703']='苏州';
ja['0704']='无锡';
ja['0705']='常州';
ja['0706']='昆山';
ja['0707']='常熟';
ja['0708']='扬州';
ja['0709']='南通';
ja['0710']='镇江';
ja['0711']='徐州';
ja['0712']='连云港';
ja['0713']='盐城';
ja['0714']='张家港';
ja['0715']='江阴';
ja['0716']='太仓';
ja['0717']='吴江';
ja['0718']='泰州';
ja['0719']='淮安';
ja['0720']='宿迁';
ja['0721']='丹阳';
ja['0722']='溧阳';
ja['0723']='泰兴';
ja['0724']='宜兴';
ja['0800']='浙江省';
ja['0802']='杭州';
ja['0803']='宁波';
ja['0804']='温州';
ja['0805']='绍兴';
ja['0806']='金华';
ja['0807']='嘉兴';
ja['0808']='台州';
ja['0809']='湖州';
ja['0810']='丽水';
ja['0811']='舟山';
ja['0812']='衢州';
ja['0813']='萧山';
ja['0814']='义乌';
ja['0815']='慈溪';
ja['0816']='海宁';
ja['0900']='四川省';
ja['0902']='成都';
ja['0903']='绵阳';
ja['0904']='乐山';
ja['0905']='泸州';
ja['0906']='德阳';
ja['0907']='宜宾';
ja['0908']='自贡';
ja['0909']='内江';
ja['0910']='攀枝花';
ja['0911']='南充';
ja['0912']='眉山';
ja['1000']='海南省';
ja['1002']='海口';
ja['1003']='三亚';
ja['1100']='福建省';
ja['1102']='福州';
ja['1103']='厦门';
ja['1104']='泉州';
ja['1105']='漳州';
ja['1106']='莆田';
ja['1107']='三明';
ja['1108']='南平';
ja['1109']='宁德';
ja['1110']='龙岩';
ja['1200']='山东省';
ja['1202']='济南';
ja['1203']='青岛';
ja['1204']='烟台';
ja['1205']='潍坊';
ja['1206']='威海';
ja['1207']='淄博';
ja['1208']='临沂';
ja['1209']='济宁';
ja['1210']='东营';
ja['1211']='泰安';
ja['1212']='日照';
ja['1213']='德州';
ja['1214']='菏泽';
ja['1215']='滨州';
ja['1216']='枣庄';
ja['1217']='聊城';
ja['1218']='莱芜';
ja['1300']='江西省';
ja['1302']='南昌';
ja['1303']='九江';
ja['1400']='广西';
ja['1402']='南宁';
ja['1403']='桂林';
ja['1404']='柳州';
ja['1405']='北海';
ja['1406']='玉林';
ja['1500']='安徽省';
ja['1502']='合肥';
ja['1503']='芜湖';
ja['1504']='安庆';
ja['1505']='马鞍山';
ja['1506']='蚌埠';
ja['1507']='阜阳';
ja['1508']='铜陵';
ja['1509']='滁州';
ja['1510']='黄山';
ja['1511']='淮南';
ja['1512']='六安';
ja['1513']='巢湖';
ja['1514']='宣城';
ja['1515']='池州';
ja['1516']='宿州';
ja['1600']='河北省';
ja['1602']='石家庄';
ja['1603']='廊坊';
ja['1604']='保定';
ja['1605']='唐山';
ja['1606']='秦皇岛';
ja['1607']='邯郸';
ja['1608']='沧州';
ja['1609']='张家口';
ja['1610']='承德';
ja['1700']='河南省';
ja['1702']='郑州';
ja['1703']='洛阳';
ja['1704']='开封';
ja['1705']='焦作';
ja['1706']='南阳';
ja['1707']='新乡';
ja['1708']='周口';
ja['1709']='安阳';
ja['1800']='湖北省';
ja['1802']='武汉';
ja['1803']='宜昌';
ja['1804']='黄石';
ja['1805']='襄樊';
ja['1806']='十堰';
ja['1807']='荆州';
ja['1808']='荆门';
ja['1809']='孝感';
ja['1810']='鄂州';
ja['1811']='黄冈';
ja['1812']='随州';
ja['1900']='湖南省';
ja['1902']='长沙';
ja['1903']='株洲';
ja['1904']='湘潭';
ja['1905']='衡阳';
ja['1906']='岳阳';
ja['1907']='常德';
ja['1908']='益阳';
ja['1909']='郴州';
ja['1910']='邵阳';
ja['1911']='怀化';
ja['1912']='娄底';
ja['1913']='永州';
ja['1914']='张家界';
ja['2000']='陕西省';
ja['2002']='西安';
ja['2003']='咸阳';
ja['2004']='宝鸡';
ja['2005']='铜川';
ja['2006']='延安';
ja['2007']='渭南';
ja['2008']='榆林';
ja['2009']='汉中';
ja['2010']='安康';
ja['2011']='商洛';
ja['2012']='杨凌';
ja['2100']='山西省';
ja['2102']='太原';
ja['2103']='运城';
ja['2104']='大同';
ja['2105']='临汾';
ja['2200']='黑龙江省';
ja['2202']='哈尔滨';
ja['2203']='伊春';
ja['2204']='绥化';
ja['2205']='大庆';
ja['2206']='齐齐哈尔';
ja['2207']='牡丹江';
ja['2208']='佳木斯';
ja['2300']='辽宁省';
ja['2302']='沈阳';
ja['2303']='大连';
ja['2304']='鞍山';
ja['2305']='营口';
ja['2306']='抚顺';
ja['2307']='锦州';
ja['2308']='丹东';
ja['2309']='葫芦岛';
ja['2310']='本溪';
ja['2311']='辽阳';
ja['2312']='铁岭';
ja['2400']='吉林省';
ja['2402']='长春';
ja['2403']='吉林';
ja['2404']='辽源';
ja['2405']='通化';
ja['2406']='四平';
ja['2407']='松原';
ja['2408']='延吉';
ja['2500']='云南省';
ja['2502']='昆明';
ja['2503']='曲靖';
ja['2504']='玉溪';
ja['2505']='大理';
ja['2506']='丽江';
ja['2507']='蒙自';
ja['2508']='开远';
ja['2509']='个旧';
ja['2510']='红河州';
ja['2600']='贵州省';
ja['2602']='贵阳';
ja['2603']='遵义';
ja['2700']='甘肃省';
ja['2702']='兰州';
ja['2703']='金昌';
ja['2800']='内蒙古';
ja['2802']='呼和浩特';
ja['2803']='赤峰';
ja['2804']='包头';
ja['2805']='嘉峪关';
ja['2806']='酒泉';
ja['2900']='宁夏';
ja['2902']='银川';
ja['3000']='西藏';
ja['3002']='拉萨';
ja['3003']='日喀则';
ja['3100']='新疆';
ja['3102']='乌鲁木齐';
ja['3103']='克拉玛依';
ja['3104']='喀什地区';
ja['3105']='伊犁';
ja['3200']='青海省';
ja['3202']='西宁';
//主要城市数据字典
var maincity=[['华北-东北',['0100','0500','2303','2302','2402','2202']],['华东地区',['0200','0702','0703','0802','0803','1502','1102','1202','1203']],['华南-华中',['0302','0400','0308','1802','1902','1702']],['西北-西南',['2002','0902','0600','2502']]];
//所有省份数据字典
var allprov=[['华北-东北',['1600','2100','2800','2300','2400','2200']],['华东地区',['0700','0800','1500','1100','1300','1200']],['华南-华中',['0300','1400','1000','1700','1800','1900']],['西北-西南',['2000','2700','3200','2900','3100','0900','2600','2500','3000']]];
var allprovArray=new Array('1600','2100','2800','2300','2400','2200','0700','0800','1500','1100','1300','1200','0300','1400','1000','1700','1800','1900','2000','2700','3200','2900','3100','0900','2600','2500','3000');
//所有省+直辖市
var allProvDuchy=new Array('0100','0200','0300','0400','0500','0600','1600','2100','2800','2300','2400','2200','0700','0800','1500','1100','1300','1200','0300','1400','1000','1700','1800','1900','2000','2700','3200','2900','3100','0900','2600','2500','3000','3300','3400','3500','3600');

function getAreaIDs(idx){
  var newArr = new Array();
  for (var i in ja){
    if(i.substr(0,2)==idx.substr(0,2)){
      newArr[newArr.length]=i;
    }
  }
  return newArr;
}

function in_array(needle, haystack) {
  if(typeof needle == 'string' || typeof needle == 'number') {
    for(var i in haystack) {
      if(haystack[i] == needle) {
          return true;
      }
    }
  }
  return false;
}


var Drag = {

  obj : null,

  init : function(o, oRoot, minX, maxX, minY, maxY, bSwapHorzRef, bSwapVertRef, fXMapper, fYMapper)
  {
    o.onmousedown = Drag.start;

    o.hmode     = bSwapHorzRef ? false : true ;
    o.vmode     = bSwapVertRef ? false : true ;

    o.root = oRoot && oRoot != null ? oRoot : o ;

    if (o.hmode  && isNaN(parseInt(o.root.style.left  ))) o.root.style.left   = "0px";
    if (o.vmode  && isNaN(parseInt(o.root.style.top   ))) o.root.style.top    = "0px";
    if (!o.hmode && isNaN(parseInt(o.root.style.right ))) o.root.style.right  = "0px";
    if (!o.vmode && isNaN(parseInt(o.root.style.bottom))) o.root.style.bottom = "0px";

    o.minX  = typeof minX != 'undefined' ? minX : null;
    o.minY  = typeof minY != 'undefined' ? minY : null;
    o.maxX  = typeof maxX != 'undefined' ? maxX : null;
    o.maxY  = typeof maxY != 'undefined' ? maxY : null;

    o.xMapper = fXMapper ? fXMapper : null;
    o.yMapper = fYMapper ? fYMapper : null;

    o.root.onDragStart  = new Function();
    o.root.onDragEnd  = new Function();
    o.root.onDrag   = new Function();
  },

  start : function(e)
  {
    var o = Drag.obj = this;
    e = Drag.fixE(e);
    var y = parseInt(o.vmode ? o.root.style.top  : o.root.style.bottom);
    var x = parseInt(o.hmode ? o.root.style.left : o.root.style.right );
    o.root.onDragStart(x, y);

    o.lastMouseX  = e.clientX;
    o.lastMouseY  = e.clientY;

    if (o.hmode) {
      if (o.minX != null) o.minMouseX = e.clientX - x + o.minX;
      if (o.maxX != null) o.maxMouseX = o.minMouseX + o.maxX - o.minX;
    } else {
      if (o.minX != null) o.maxMouseX = -o.minX + e.clientX + x;
      if (o.maxX != null) o.minMouseX = -o.maxX + e.clientX + x;
    }

    if (o.vmode) {
      if (o.minY != null) o.minMouseY = e.clientY - y + o.minY;
      if (o.maxY != null) o.maxMouseY = o.minMouseY + o.maxY - o.minY;
    } else {
      if (o.minY != null) o.maxMouseY = -o.minY + e.clientY + y;
      if (o.maxY != null) o.minMouseY = -o.maxY + e.clientY + y;
    }

    document.onmousemove  = Drag.drag;
    document.onmouseup    = Drag.end;

    return false;
  },

  drag : function(e)
  {
    e = Drag.fixE(e);
    var o = Drag.obj;

    var ey  = e.clientY;
    var ex  = e.clientX;
    var y = parseInt(o.vmode ? o.root.style.top  : o.root.style.bottom);
    var x = parseInt(o.hmode ? o.root.style.left : o.root.style.right );
    var nx, ny;

    if (o.minX != null) ex = o.hmode ? Math.max(ex, o.minMouseX) : Math.min(ex, o.maxMouseX);
    if (o.maxX != null) ex = o.hmode ? Math.min(ex, o.maxMouseX) : Math.max(ex, o.minMouseX);
    if (o.minY != null) ey = o.vmode ? Math.max(ey, o.minMouseY) : Math.min(ey, o.maxMouseY);
    if (o.maxY != null) ey = o.vmode ? Math.min(ey, o.maxMouseY) : Math.max(ey, o.minMouseY);

    nx = x + ((ex - o.lastMouseX) * (o.hmode ? 1 : -1));
    ny = y + ((ey - o.lastMouseY) * (o.vmode ? 1 : -1));

    if (o.xMapper)    nx = o.xMapper(y)
    else if (o.yMapper) ny = o.yMapper(x)

    Drag.obj.root.style[o.hmode ? "left" : "right"] = nx + "px";
    Drag.obj.root.style[o.vmode ? "top" : "bottom"] = ny + "px";
    Drag.obj.lastMouseX = ex;
    Drag.obj.lastMouseY = ey;

    Drag.obj.root.onDrag(nx, ny);
    return false;
  },

  end : function()
  {
    document.onmousemove = null;
    document.onmouseup   = null;
    Drag.obj.root.onDragEnd(  parseInt(Drag.obj.root.style[Drag.obj.hmode ? "left" : "right"]), 
                  parseInt(Drag.obj.root.style[Drag.obj.vmode ? "top" : "bottom"]));
    Drag.obj = null;
  },

  fixE : function(e)
  {
    if (typeof e == 'undefined') e = window.event;
    if (typeof e.layerX == 'undefined') e.layerX = e.offsetX;
    if (typeof e.layerY == 'undefined') e.layerY = e.offsetY;
    return e;
  }
};

var masked=false;
// 全屏遮罩层
function boxAlpha (){
  if (masked==false){
    maskLayer();
    masked=true;
  }
  else{
    $('#maskLayer').hide();
    masked=false;
  }
}

function maskLayer(){
  var FW=document.body.scrollWidth;
  var FH=document.body.scrollHeight;
  var SH=window.screen.height;
  FH=FH<SH?SH:FH;
  $("#alphadiv").height("100%").width("100%");
  $('#maskLayer').show();
}

function draglayer(){
  var och=$("#drag").height();
  var ocw=$("#drag").width();
  var bsl = document.documentElement.scrollLeft;
  var bst = document.documentElement.scrollTop;
  var bcw = document.documentElement.clientWidth;
  var bch = document.documentElement.clientHeight;
/* 
  !DOCTYPE声明bug调试
  var bsl = document.body.scrollLeft || document.documentElement.scrollLeft;
  var bst = document.body.scrollTop || document.documentElement.scrollTop;
  var bcw = document.body.clientWidth || document.documentElement.clientWidth;
  var bch = document.body.clientHeight || document.documentElement.clientHeight; 
*/
  var osl = bsl + Math.floor( ( bcw - ocw ) / 2 );
  osl = Math.max( bsl , osl );
  var ost = bst + Math.floor( ( bch - och ) / 2 );
  ost = Math.max( bst , ost );

  $("#drag").css({left: osl, width:ocw, top: "50%", transform: "translateY(-50%)"}).show();
  var theHandle = document.getElementById("drag_h");
  var theRoot   = document.getElementById("drag");
  Drag.init(theHandle, theRoot);
}
$(window).resize(function (){
  if (masked==true){
    draglayer();
    maskLayer();
  }
});


var jobArea_Arr = new Array();
//var jobArea_Arr = new Array('0100','0200','2402');

global.jobArea = {
  Show : function(){
    var k=0,output='',output2='',arr,area,select_ed;
    var Div   = new Array('maincity2','allProv2');
    var Title = new Array('<h4>主要城市：</h4>','<h4>所有省份：</h4>');
    var LoopArr = new Array(maincity,allprov);

    for(var i in jobArea_Arr){
      output2+='<li class="jobArea'+jobArea_Arr[i]+' chkON" onclick="jobArea.Chk(\''+jobArea_Arr[i]+'\')">'+ja[jobArea_Arr[i]]+'</li>';
    }
    $('#jobAreSelected dd').html(output2);

    while(k<=1){
      output  = Title[k];
      arr   = LoopArr[k]
      for (var i in arr){
        area=arr[i][0];
        output+='<dl><dt>'+area+'</dt><dd>';
        for (var j in arr[i][1] ){

          var id=arr[i][1][j];
          if(k==0){
            select_ed=in_array(id,jobArea_Arr)?' chkON':'';
            output+='<li class="jobArea'+id+select_ed+'" onclick="jobArea.Chk(\''+id+'\')">'+ja[id]+'</li>';
          }else{
            if(area=='其它') output+='<li class="jobArea'+id+'" onclick="jobArea.Chk(\''+id+'\')">'+ja[id]+'</li>';
            else output+='<li onclick="jobArea.SubLayer(\''+id+'\')">'+ja[id]+'</li>';
          }
        }
        output+='</dd></dl>';
      }
      
      $('#'+Div[k]).html(output);
      k++;
    }
    $('#drag').width('580px');
    // 鼠标悬停变色
    $('#jobAreaAlpha li').hover(function(){$(this).addClass('over')},function(){$(this).removeClass('over')});
    // 点击弹出子菜单
    $('#allProv2 li').click(function(e){
      $("#sublist").css({top:e.pageY-4,left:e.pageX-4}).hover(function(){
        $(this).show()
      }, function(){$(this).hide()}
      )})
  },
  // 所有省份 下拉 城市菜单
  SubLayer : function(id){
    var output='<div id="sub_jobArea">',width,select_ed,key;
    select_ed=in_array(id,jobArea_Arr)?' chkON':'';
    var arr=getAreaIDs(id);
      width=Math.ceil(Math.sqrt(arr.length-1))*60;
    output+='<ul style="width:'+width+'px"><h4 onclick="jobArea.Chk(\''+id+'\')">';
    output+='<a href="javascript:" class="jobArea' + id + select_ed +'">'+ja[id]+'</a></h4>';

    for (var i=1;i<arr.length;i++){
      key=arr[i];
      select_ed=in_array(key,jobArea_Arr)?' chkON':'';
      output+='<li><a href="javascript:" class="jobArea' + key + select_ed +'" onclick="jobArea.Chk(\''+key+'\')">'+ja[key]+'</a></li>';
    }
    output=output+'</ul></div>';
    $("#sublist").html(output).show();
  },

  Chk : function(id){
    if(!in_array(id,jobArea_Arr)){
      var subArea,myid;
      if(id.substr(2)=='00'){ // 选中父类清除子类
        subArea=getAreaIDs(id);
        for(var i in subArea){
          if(in_array(subArea[i],jobArea_Arr)) this.del(subArea[i]);
        }
      }else{  // 选中子类清除父类
        myid=id.substr(0,2)+'00';
        if(in_array(myid,jobArea_Arr)) this.del(myid);
      };
      if(jobArea_Arr.length<5){
        jobArea_Arr[jobArea_Arr.length]=id;
        var html='<li class="jobArea'+id+'" onclick="jobArea.Chk(\''+id+'\')">'+ja[id]+'</li>';
        $('#jobAreSelected dd').append(html);
        $('.jobArea'+id).addClass('chkON');
        $('#jobAreSelected li').hover(function(){$(this).addClass('over')},function(){$(this).removeClass('over')});
      }else{
        alert('您最多能选择5项');
        return false;
      }
    }else{
      this.del(id);
    }
  },
  del : function(id){
    for (var i in jobArea_Arr){
      if(jobArea_Arr[i]==id) jobArea_Arr.splice(i,1);;
    }
    $('#jobAreSelected .jobArea'+id).remove();
    $('.jobArea'+id).removeClass('chkON');
  },
  // 确定
  confirm : function(){
    var areaStr='';
    for(var i in jobArea_Arr){
      areaStr+='/'+ja[jobArea_Arr[i]];
    }
    areaStr=areaStr.substring(1)?areaStr.substring(1):'请选择地区'; 
    $('#btn_jobArea').html(areaStr);
    $('#btn_jobArea').trigger("change");
    $('#jobAreaID').val(jobArea_Arr);
    boxAlpha();
    $('#jobAreSelected dd').empty();
    $("body").css({"overflow": ""})
  },

  cancel : function(){
    boxAlpha();
    $('#jobAreSelected dd').empty();
    $("body").css({"overflow": ""})
  }
}

export function jobAreaSelect(){
  var dragHtml ='<div id="jobAreaAlpha">';    //地区
    dragHtml+='   <dl id="jobAreSelected"><dt>已选地点：</dt><dd></dd></dl>';
    dragHtml+='   <div id="maincity2"></div>';//主要城市
    dragHtml+='   <div id="allProv2"></div>'; //所有省市
    dragHtml+='</div>';
  $('#drag_h').html('<b>请选择地区（您最多能选择5项）</b><span onclick="jobArea.confirm()">确定</span>');
  $('#drag_con').html(dragHtml);
  $("#maskLayer").css({width: "100%", height: "100%"})
  $("body").css({overflow: "hidden"})
  jobArea.Show();
  boxAlpha();
  draglayer();
}